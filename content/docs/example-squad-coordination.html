<h1>Example: Squad Coordination AI</h1>
<p class="note">Complete working example of coordinated squad AI using BaseSquadCombat archetype. Includes leader-directed strategy, shared intel, role-based actions, and dynamic tactics.</p>

<div class="page-meta">
  <span class="time"><i data-lucide="clock"></i> 35 minutes</span>
  <span class="difficulty"><i data-lucide="code"></i> Example</span>
</div>

<div class="callout tip">
  <span class="icon"><i data-lucide="lightbulb"></i></span>
  <div>
    <strong>What You'll Build:</strong> A 4-member tactical squad that shares enemy intel, follows leader-directed strategies (Search/Assault/Flank/Hold/Retreat), adapts to threats dynamically, and coordinates actions based on roles.
  </div>
</div>

<h2>Final Result</h2>

<pre><code>Squad AI System:
├─ Leader (1 agent)
│  ├─ Analyzes threat situation
│  ├─ Synthesizes squad strategy
│  ├─ Directs squad members
│  └─ Makes tactical calls
├─ Members (3 agents)
│  ├─ Report enemy sightings
│  ├─ Follow squad strategy
│  ├─ Execute role-based actions
│  └─ Maintain formation

Strategies:
✓ Search: Coordinated patrol when no enemies
✓ Assault: Direct engagement when enemies detected
✓ Flank: Maneuver when enemies in cover
✓ Hold: Defensive position when outnumbered
✓ Retreat: Fall back when overwhelmed</code></pre>

<h2>Step 1: Squad Infrastructure</h2>

<h3>Squad Manager (GameMode or Level Actor)</h3>

<pre><code>// C++ GameMode or BP Level Actor
AMyGameMode::AMyGameMode()
{
    // Create squad management component
    TacticalSquadComponent = CreateDefaultSubobject<UTacticalSquadComponent>(TEXT("TacticalSquad"));
}

Or Blueprint:
  Event BeginPlay
    → Spawn Actor (BP_SquadManager)
      Components:
        + TacticalSquadComponent
    → Store reference globally</code></pre>

<h2>Step 2: Create Squad Leader</h2>

<h3>Blueprint: BP_SquadLeader</h3>

<pre><code>Parent Class: Character

Components:
  + Skeletal Mesh
  + AIPerception
    Senses:
      - AISight (3500 radius, 110° FOV)
      - AIHearing (2500 radius)
      - AIDamage
  + TacticalMember
    SquadName: "Alpha"
    TeamID: 1
    bIsLeader: true // LEADER FLAG
  + TacticalSquadInputProvider
  + CINQuickSetup
    AgentType: BaseSquadCombat
    bAutoInitialize: true

Variables:
  + Health (float): 100.0
  + AmmoCount (int32): 30
  + SquadName (FName): "Alpha"</code></pre>

<h3>Leader AI Controller</h3>

<pre><code>Parent: AAIController

Event OnPossess
  → Set Generic Team ID (1)
  → Assign squad name to TacticalMember</code></pre>

<h2>Step 3: Create Squad Members</h2>

<h3>Blueprint: BP_SquadMember</h3>

<pre><code>Parent Class: Character

Components:
  + Skeletal Mesh
  + AIPerception (same as leader)
  + TacticalMember
    SquadName: "Alpha"
    TeamID: 1
    bIsLeader: false // MEMBER FLAG
  + TacticalSquadInputProvider
  + CINQuickSetup
    AgentType: BaseSquadCombat
    bAutoInitialize: true

Variables:
  + Health (float): 100.0
  + AmmoCount (int32): 30
  + Role (ESquadRole): Rifleman/Flanker/Support</code></pre>

<h2>Step 4: Configure Squad Services</h2>

<h3>Service Setup</h3>

<pre><code>All Squad Members (Leader + Members):
  Services:
    [0] UService_PerceptionMonitor
        StimulusMemoryDuration: 15.0
        bPublishEnemyInputs: true
        bPublishThreatInputs: true
        
    [1] UService_TacticalSense
        bReportToSquad: true
        bPublishPersonalInputs: false // Use squad inputs instead

Leader Only:
  Additional Service:
    [2] UService_TacticalStrategy
        StrategyUpdateInterval: 1.0
        StrategyTTL: 5.0
        
All Members Receive:
  - Squad strategy via TacticalSquadInputProvider
  - Shared enemy intel from TacticalSquadComponent
  - Role assignment based on member index</code></pre>

<h2>Step 5: Leader Actions</h2>

<h3>Action 1: DA_Action_Leader_DirectSquad</h3>

<pre><code>ActionName: "DirectSquad"
DisplayName: "Direct Squad Strategy"
BaseScore: 50.0
Priority: 60

Considerations:
  1. IsSquadLeader
     InputName: "IsSquadLeader"
     ResponseCurve: (0,0) → (1,100)
     Weight: 1.0
     Comment: Only leaders execute
     
  2. SquadMemberCount
     InputName: "SquadMemberCount"
     ResponseCurve: (0,0) → (0.3,100) → (1,100)
     Weight: 1.0
     Comment: Need squad to direct

Executor: Behavior Tree
  BehaviorTree: BT_Leader_Direct
  
BT_Leader_Direct:
  → Analyze Squad State
  → Calculate Threat
  → Broadcast Strategy
  → Issue Movement Orders</code></pre>

<h3>Action 2: DA_Action_Leader_Attack</h3>

<pre><code>ActionName: "Attack"
DisplayName: "Lead Attack"
BaseScore: 70.0
Priority: 50

Considerations:
  1. SquadStrategy_Assault
     InputName: "SquadStrategy_Assault"
     ResponseCurve: (0,20) → (1,100)
     Weight: 1.5
     
  2. HasVisibleEnemy
     InputName: "HasVisibleEnemy"
     ResponseCurve: (0,0) → (1,100)
     Weight: 1.0
     
  3. Health
     InputName: "Health"
     ResponseCurve: (0,30) → (0.5,80) → (1,100)
     Weight: 0.8

Executor: BT_Squad_Attack</code></pre>

<h3>Action 3: DA_Action_Leader_Retreat</h3>

<pre><code>ActionName: "Retreat"
DisplayName: "Order Retreat"
BaseScore: 85.0
Priority: 90 (high priority)

Considerations:
  1. SquadStrategy_Retreat
     InputName: "SquadStrategy_Retreat"
     ResponseCurve: (0,0) → (1,100)
     Weight: 1.5
     
  2. SquadMemberCount
     InputName: "SquadMemberCount"
     ResponseCurve: (0,100) → (0.5,50) → (1,0)
     bInvertCurve: true
     Weight: 1.0
     Comment: Fewer members = more urgent

Executor: BT_Leader_OrderRetreat</code></pre>

<h2>Step 6: Member Actions</h2>

<h3>Action 1: DA_Action_Member_FollowStrategy</h3>

<pre><code>ActionName: "FollowStrategy"
DisplayName: "Execute Squad Strategy"
BaseScore: 60.0
Priority: 50

Considerations:
  1. IsInSquad
     InputName: "IsInSquad"
     ResponseCurve: (0,0) → (1,100)
     Weight: 1.0
     
  2. Strategy Match (one of):
     SquadStrategy_Assault: Execute attack
     SquadStrategy_Flank: Execute flank
     SquadStrategy_Hold: Execute hold
     SquadStrategy_Retreat: Execute retreat

Implementation:
  Switch on active strategy flag
  Execute appropriate behavior</code></pre>

<h3>Action 2: DA_Action_Member_Flank</h3>

<pre><code>ActionName: "Flank"
DisplayName: "Flank Enemy Position"
BaseScore: 65.0
Priority: 55

Considerations:
  1. SquadStrategy_Flank
     InputName: "SquadStrategy_Flank"
     ResponseCurve: (0,0) → (1,100)
     Weight: 1.5
     
  2. SquadMemberIndex
     InputName: "SquadMemberIndex"
     ResponseCurve: (0,20) → (0.5,100) → (1,20)
     Weight: 1.0
     Comment: Mid-squad members flank
     
  3. HasKnownEnemy
     InputName: "HasKnownEnemy"
     ResponseCurve: (0,0) → (1,100)
     Weight: 1.0

Executor: BT_Member_Flank
  → Get flanking position (left/right based on index)
  → Move to flank
  → Engage from angle</code></pre>

<h3>Action 3: DA_Action_Member_Hold</h3>

<pre><code>ActionName: "Hold"
DisplayName: "Hold Defensive Position"
BaseScore: 60.0
Priority: 50

Considerations:
  1. SquadStrategy_Hold
     InputName: "SquadStrategy_Hold"
     ResponseCurve: (0,0) → (1,100)
     Weight: 1.5
     
  2. HasCoverNearby
     InputName: "HasCoverNearby"
     ResponseCurve: (0,30) → (1,100)
     Weight: 1.0

Executor: BT_Member_Hold
  → Find cover
  → Move to cover
  → Take defensive stance
  → Suppress enemies</code></pre>

<h2>Step 7: Strategy System</h2>

<h3>Strategy Synthesis (Leader)</h3>

<pre><code>UService_TacticalStrategy (runs on leader only)

void UService_TacticalStrategy::TickService(float DeltaTime)
{
    if (!GetMember()->IsSquadLeader())
        return;
    
    // Get squad state
    FSquadState Squad = GetSquadState();
    int32 EnemyCount = Squad.KnownEnemies.Num();
    int32 MemberCount = Squad.Members.Num();
    int32 AliveMembers = CountAliveMembers();
    
    // Calculate threat ratio
    float ThreatRatio = (float)EnemyCount / FMath::Max(1, AliveMembers);
    
    // Synthesize strategy
    ESquadStrategy NewStrategy = ESquadStrategy::Search;
    
    if (EnemyCount == 0)
    {
        // No enemies - search
        NewStrategy = ESquadStrategy::Search;
    }
    else if (ThreatRatio > 2.0f || AliveMembers <= 1)
    {
        // Outnumbered or decimated - retreat
        NewStrategy = ESquadStrategy::Retreat;
    }
    else if (EnemiesInCover() && AliveMembers >= 3)
    {
        // Enemies in cover, enough members - flank
        NewStrategy = ESquadStrategy::Flank;
    }
    else if (ThreatRatio > 1.2f)
    {
        // Slightly outnumbered - hold position
        NewStrategy = ESquadStrategy::Hold;
    }
    else
    {
        // Favorable - assault
        NewStrategy = ESquadStrategy::Assault;
    }
    
    // Update squad strategy
    GetSquadManager()->SetSquadStrategy(GetSquadName(), NewStrategy, 1.0f);
}</code></pre>

<h3>Strategy Decision Tree</h3>

<pre><code>Strategy Selection:

No Enemies:
  → Search (patrol, investigate)

Enemies Detected:
  ThreatRatio > 2.0 OR AliveMembers <= 1:
    → Retreat (fall back, regroup)
  
  Enemies In Cover AND AliveMembers >= 3:
    → Flank (maneuver, surround)
  
  ThreatRatio > 1.2:
    → Hold (defensive position)
  
  Else:
    → Assault (aggressive engagement)</code></pre>

<h2>Step 8: Intel Sharing</h2>

<h3>Enemy Reporting (All Members)</h3>

<pre><code>UService_TacticalSense (runs on all squad members)

void UService_TacticalSense::TickService(float DeltaTime)
{
    // Get perception data
    TArray<AActor*> KnownEnemies = GetKnownEnemies();
    
    // Report to squad
    UTacticalMemberComponent* Member = GetMember();
    UTacticalSquadComponent* Squad = GetSquadManager();
    
    for (AActor* Enemy : KnownEnemies)
    {
        FVector EnemyLocation = Enemy->GetActorLocation();
        Squad->ReportEnemy(Member->GetSquadName(), Enemy, EnemyLocation);
    }
    
    // Now all squad members know about this enemy
    // Even if they can't see it themselves
}</code></pre>

<h3>Shared Intel Benefits</h3>

<pre><code>Example Scenario:

Member 1 spots enemy at location A
  → Reports to squad via TacticalSense
  
Member 2 (can't see enemy) receives intel
  → SquadKnownEnemies input increases
  → Can move to investigate/flank
  
Member 3 (different angle) also informed
  → Coordinates approach
  → Avoids duplicate search
  
Leader synthesizes strategy
  → Sees 1 enemy vs 4 members
  → Sets strategy to Assault
  → All members receive strategy
  → Coordinated attack begins</code></pre>

<h2>Step 9: Role-Based Actions</h2>

<h3>Flanker Role (Member Index 1 & 3)</h3>

<pre><code>Action: DA_Action_Flanker
  Considerations:
    SquadStrategy_Flank: High weight
    SquadMemberIndex: Bell curve at 0.3 and 0.7
    
  Behavior:
    Index 1 (0.25): Flank left
    Index 3 (0.75): Flank right
    
  Result: Symmetric flanking maneuver</code></pre>

<h3>Point Man Role (Member Index 0)</h3>

<pre><code>Action: DA_Action_PointMan
  Considerations:
    SquadMemberIndex: (0,100) → (0.2,80) → (1,0)
    SquadStrategy_Assault: High
    
  Behavior:
    Lead the advance
    First to engage
    Call out targets</code></pre>

<h3>Rear Guard Role (Member Index 2)</h3>

<pre><code>Action: DA_Action_RearGuard
  Considerations:
    SquadMemberIndex: (0,0) → (0.8,80) → (1,100)
    SquadStrategy_Retreat: High
    
  Behavior:
    Cover retreat
    Suppressive fire
    Last to fall back</code></pre>

<h2>Step 10: Formation System</h2>

<h3>Formation Positions</h3>

<pre><code>Search Formation (Line):
  Leader: Front Center
  Member 0: Front Left
  Member 1: Front Right
  Member 2: Rear Center
  
  L - 0 - 1 - 2
  
Assault Formation (Wedge):
  Leader: Point
  Member 0: Left Wing
  Member 1: Right Wing
  Member 2: Center Rear
  
      L
    0   1
      2

Hold Formation (Box):
  Defensive square
  Overlapping fields of fire
  
  0   L
  2   1</code></pre>

<h2>Step 11: Communication</h2>

<h3>Callouts</h3>

<pre><code>// Blueprint or C++
void CallOut(ECalloutType Type, FVector Location)
{
    switch (Type)
    {
    case ECalloutType::EnemySpotted:
        PlaySound(EnemySpottedSound);
        BroadcastToSquad("Enemy spotted!", Location);
        break;
        
    case ECalloutType::Reloading:
        PlaySound(ReloadingSound);
        // Squad adjusts - others provide cover
        break;
        
    case ECalloutType::ManDown:
        PlaySound(ManDownSound);
        // Leader reevaluates strategy
        break;
    }
}</code></pre>

<h2>Step 12: Test Scenarios</h2>

<h3>Scenario 1: Search Pattern</h3>

<pre><code>Setup:
  - Spawn 4-member squad
  - No enemies initially
  
Expected:
  → Strategy: Search
  → Formation: Line
  → Leader directs patrol
  → Members maintain spacing
  → Coordinated movement</code></pre>

<h3>Scenario 2: Contact</h3>

<pre><code>Setup:
  - Squad on patrol
  - Single enemy appears
  
Expected:
  → Member spots enemy
  → Reports to squad (TacticalSense)
  → All members informed
  → Leader analyzes: 1 enemy vs 4 members
  → Strategy changes to Assault
  → Squad converges on enemy
  → Coordinated attack</code></pre>

<h3>Scenario 3: Flanking Maneuver</h3>

<pre><code>Setup:
  - Squad engages 2 enemies in cover
  
Expected:
  → Leader detects enemies in cover
  → Strategy: Flank
  → Member 0: Frontal pressure
  → Member 1: Flank left
  → Member 3: Flank right
  → Member 2: Support fire
  → Enemies engaged from 3 angles</code></pre>

<h3>Scenario 4: Tactical Retreat</h3>

<pre><code>Setup:
  - Squad engages 8 enemies
  - 2 squad members killed
  
Expected:
  → ThreatRatio: 8 / 2 = 4.0 (critical)
  → Leader orders Retreat
  → Member 2 (rear guard) covers
  → Others fall back
  → Regroup at safe distance</code></pre>

<h2>Complete Configuration Summary</h2>

<pre><code>Squad Manager:
  Component: UTacticalSquadComponent
  
Squad Leader:
  Components:
    - AIPerception
    - TacticalMember (bIsLeader: true)
    - TacticalSquadInputProvider
    - CINQuickSetup (BaseSquadCombat)
  Services:
    - PerceptionMonitor
    - TacticalSense
    - TacticalStrategy (leader only)
  Actions:
    - DirectSquad (P:60)
    - Attack (P:50)
    - Retreat (P:90)

Squad Members (x3):
  Components:
    - AIPerception
    - TacticalMember (bIsLeader: false)
    - TacticalSquadInputProvider
    - CINQuickSetup (BaseSquadCombat)
  Services:
    - PerceptionMonitor
    - TacticalSense
  Actions:
    - FollowStrategy (P:50)
    - Flank (P:55)
    - Hold (P:50)
    - Attack (P:45)

Strategy Flow:
  Members perceive → Report to squad → Leader analyzes →
  Synthesizes strategy → Broadcasts → Members execute →
  Formation adapts → Roles coordinate → Success</code></pre>

<h2>Next Steps</h2>

<div class="next-steps">
  <a class="button primary" href="#/docs/squad-setup">
    <i data-lucide="users"></i>
    Squad Setup Guide
  </a>
  <a class="button" href="#/docs/tactical-components-api">
    <i data-lucide="layers"></i>
    Tactical Components API
  </a>
</div>

<h3>Related Examples</h3>
<ul>
  <li><a href="#/docs/example-combat-soldier"><i data-lucide="crosshair"></i> Combat Soldier</a> - Individual soldier AI</li>
  <li><a href="#/docs/example-stealth-guard"><i data-lucide="eye-off"></i> Stealth Guard</a> - Investigation AI</li>
  <li><a href="#/docs/squad-setup"><i data-lucide="users"></i> Squad Setup</a> - Detailed squad guide</li>
  <li><a href="#/docs/perception-setup"><i data-lucide="eye"></i> Perception Setup</a> - Perception configuration</li>
</ul>

<script>lucide.createIcons();</script>
