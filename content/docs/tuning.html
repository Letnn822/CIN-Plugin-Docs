<h1>Tuning & Balancing</h1>
<p class="note">Master the art of AI tuning. Learn systematic approaches to balance action scores, eliminate undesirable behaviors, and create believable, challenging AI that matches your game's difficulty curve.</p>

<div class="page-meta">
  <span class="time"><i data-lucide="clock"></i> 20 minutes</span>
  <span class="difficulty"><i data-lucide="bar-chart-2"></i> Intermediate</span>
</div>

<div class="callout tip">
  <span class="icon"><i data-lucide="lightbulb"></i></span>
  <div>
    <strong>Tuning Philosophy:</strong> Start with working AI, then iterate based on observation. Use data-driven adjustments, not guesswork. The Gameplay Debugger is your best friend.
  </div>
</div>

<h2>The Tuning Process</h2>

<pre><code>Tuning Workflow:
┌─────────────────────────────────────────────┐
│ 1. OBSERVE: Watch AI behavior in-game      │
│    └─ Use Gameplay Debugger                │
│    └─ Record action scores                 │
│    └─ Note unexpected behaviors            │
└──────────────┬──────────────────────────────┘
               ▼
┌─────────────────────────────────────────────┐
│ 2. DIAGNOSE: Identify the problem          │
│    └─ Action scores too close?             │
│    └─ Action never wins?                   │
│    └─ Thrashing between actions?           │
│    └─ Spamming one action?                 │
└──────────────┬──────────────────────────────┘
               ▼
┌─────────────────────────────────────────────┐
│ 3. ADJUST: Apply targeted fix              │
│    └─ Tweak base scores                    │
│    └─ Adjust consideration curves          │
│    └─ Add momentum/resistance              │
│    └─ Modify priorities                    │
└──────────────┬──────────────────────────────┘
               ▼
┌─────────────────────────────────────────────┐
│ 4. TEST: Verify improvement                │
│    └─ Play multiple scenarios              │
│    └─ Check edge cases                     │
│    └─ Measure score distributions          │
└──────────────┬──────────────────────────────┘
               ▼
┌─────────────────────────────────────────────┐
│ 5. ITERATE: Repeat until satisfied         │
│    └─ Document what works                  │
│    └─ Keep baseline configurations         │
└─────────────────────────────────────────────┘</code></pre>

<h2>Common Problems & Solutions</h2>

<h3>Problem 1: Action Never Executes</h3>

<p><strong>Symptoms:</strong></p>
<ul>
  <li>Action always scores 0 or near-zero</li>
  <li>Action appears in list but never wins</li>
</ul>

<p><strong>Diagnosis with Debugger:</strong></p>
<pre><code>Press ' → 5 → Select Agent

Action List:
  • Attack: 68.5 ✓ (Currently executing)
  • TakeCover: 45.2
  • Reload: 12.0
  • ThrowGrenade: 0.0 ← Never executes!

Check considerations:
  ThrowGrenade considerations:
    × GrenadeCount: 0.0 (no grenades!)
    ✓ EnemyCluster: 0.8
    ✓ SafeToThrow: 0.7
  
  Final: 55 × 0.0 × 0.8 × 0.7 = 0.0</code></pre>

<p><strong>Solutions:</strong></p>

<table>
  <thead>
    <tr>
      <th>Cause</th>
      <th>Fix</th>
      <th>Implementation</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>Consideration at 0</td>
      <td>Remove or adjust curve</td>
      <td>GrenadeCount: 0→20, 1→100 (softens requirement)</td>
    </tr>
    <tr>
      <td>Base score too low</td>
      <td>Increase base score</td>
      <td>55 → 65 or 70</td>
    </tr>
    <tr>
      <td>Too many considerations</td>
      <td>Reduce to 2-3 key ones</td>
      <td>Remove least important</td>
    </tr>
    <tr>
      <td>Other actions dominate</td>
      <td>Lower their scores</td>
      <td>Attack: 68 → 60</td>
    </tr>
  </tbody>
</table>

<h3>Problem 2: Rapid Action Switching (Thrashing)</h3>

<p><strong>Symptoms:</strong></p>
<ul>
  <li>AI switches actions every 0.1-0.5 seconds</li>
  <li>Jittery, unrealistic behavior</li>
  <li>Never completes any action</li>
</ul>

<p><strong>Diagnosis:</strong></p>
<pre><code>Action History:
  Frame 100: Attack (score: 50.3)
  Frame 102: TakeCover (score: 50.8)
  Frame 104: Attack (score: 51.1)
  Frame 106: TakeCover (score: 50.4)
  Frame 108: Attack (score: 50.9)
  
Problem: Scores too close (±1 point), no resistance</code></pre>

<p><strong>Solutions:</strong></p>

<table>
  <thead>
    <tr>
      <th>Technique</th>
      <th>When to Use</th>
      <th>Configuration</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><strong>Replace Resistance</strong></td>
      <td>Scores within 10-20%</td>
      <td>Set ReplaceResistance: 1.2-1.5</td>
    </tr>
    <tr>
      <td><strong>Score Separation</strong></td>
      <td>Chronic ties</td>
      <td>Increase score gaps (50→45, 50→55)</td>
    </tr>
    <tr>
      <td><strong>Priority</strong></td>
      <td>Some actions more important</td>
      <td>Set Priority: 10, 5, 0, -5</td>
    </tr>
    <tr>
      <td><strong>Momentum</strong></td>
      <td>Completing action important</td>
      <td>Set MaxMomentum: 2.0, Reduction: 10</td>
    </tr>
  </tbody>
</table>

<p><strong>Example Fix:</strong></p>
<pre><code>Before:
  Attack: Base 50, Resistance 1.0
  TakeCover: Base 50, Resistance 1.0
  → Thrashing

After:
  Attack: Base 55, Resistance 1.3, Priority 0
  TakeCover: Base 50, Resistance 1.3, Priority 5
  → Stable, TakeCover wins ties</code></pre>

<h3>Problem 3: Action Spam</h3>

<p><strong>Symptoms:</strong></p>
<ul>
  <li>AI executes same action repeatedly with no pause</li>
  <li>Unrealistic (attack-attack-attack-attack)</li>
</ul>

<p><strong>Diagnosis:</strong></p>
<pre><code>Action History:
  0.0s: Attack (complete)
  0.5s: Attack (complete)
  1.0s: Attack (complete)
  1.5s: Attack (complete)
  
Problem: No momentum to reduce score after use</code></pre>

<p><strong>Solutions:</strong></p>

<pre><code>Add Momentum:
  MaxMomentum: 3.0
  MomentumScoreReduction: 15.0
  MomentumDecayTime: 2.5s

Effect:
  0.0s: Attack (score: 60) → Execute
  0.5s: Attack (score: 45, -15) → Doesn't win
  1.0s: Attack (score: 30, -30) → Doesn't win
  2.5s: Momentum decays → Score recovers
  3.0s: Attack (score: 60) → Can execute again</code></pre>

<h3>Problem 4: Critical Action Interrupted</h3>

<p><strong>Symptoms:</strong></p>
<ul>
  <li>AI starts reloading, sees enemy, cancels reload</li>
  <li>Now out of ammo and can't fight</li>
  <li>Gets stuck in cancel-restart loop</li>
</ul>

<p><strong>Diagnosis:</strong></p>
<pre><code>0.0s: Start Reload (score: 80, ammo: 0%)
0.2s: See Enemy → Attack scores 85
0.2s: Interrupt Reload, start Attack
0.3s: Can't attack (no ammo)
0.4s: Reload scores 90 again
0.4s: Start Reload...
→ Loop!</code></pre>

<p><strong>Solutions:</strong></p>

<table>
  <thead>
    <tr>
      <th>Fix</th>
      <th>Configuration</th>
      <th>Result</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>Non-Interruptible</td>
      <td>Reload: bInterruptible = false</td>
      <td>Must complete once started</td>
    </tr>
    <tr>
      <td>High Resistance</td>
      <td>Reload: ReplaceResistance = 3.0</td>
      <td>Hard to interrupt</td>
    </tr>
    <tr>
      <td>Higher Priority</td>
      <td>Reload: Priority = 20</td>
      <td>Wins when scores close</td>
    </tr>
    <tr>
      <td>Task Locking</td>
      <td>Reload: UnlockTime = 3.0s</td>
      <td>If aborted, can't retry for 3s</td>
    </tr>
  </tbody>
</table>

<h3>Problem 5: Too Passive/Aggressive</h3>

<p><strong>Symptoms:</strong></p>
<ul>
  <li>AI too defensive (never attacks)</li>
  <li>AI too aggressive (never takes cover)</li>
</ul>

<p><strong>Diagnosis:</strong></p>
<pre><code>Too Defensive:
  TakeCover: 75 (always wins)
  Attack: 55 (never wins)
  
Too Aggressive:
  Attack: 85 (always wins)
  TakeCover: 40 (never wins)
  Retreat: 30 (never wins)</code></pre>

<p><strong>Solutions:</strong></p>

<pre><code>Balanced Combat AI:
  Attack: 60 (primary)
    └─ Considerations boost when:
       - Healthy (0.7+ health)
       - Has ammo
       - Clear shot
  
  TakeCover: 70 (defensive priority)
    └─ Considerations boost when:
       - Low health (<0.4)
       - Under fire
       - Reloading
  
  Reload: 80 (critical)
    └─ Considerations boost when:
       - Low ammo (<0.3)
       - Not under immediate threat
  
  Retreat: 65 (emergency)
    └─ Considerations boost when:
       - Critical health (<0.2)
       - Outnumbered
       - No cover nearby</code></pre>

<h2>Score Balancing Guidelines</h2>

<h3>Recommended Base Score Ranges</h3>

<table>
  <thead>
    <tr>
      <th>Action Type</th>
      <th>Base Score</th>
      <th>Examples</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><strong>Critical/Emergency</strong></td>
      <td>80-100</td>
      <td>Reload (empty), Flee (dying), PhaseTransition</td>
    </tr>
    <tr>
      <td><strong>High Priority</strong></td>
      <td>65-80</td>
      <td>TakeCover, Heal, Defensive actions</td>
    </tr>
    <tr>
      <td><strong>Primary Actions</strong></td>
      <td>50-65</td>
      <td>Attack, Ability use, Objective actions</td>
    </tr>
    <tr>
      <td><strong>Secondary Actions</strong></td>
      <td>35-50</td>
      <td>Reposition, CallForHelp, Investigation</td>
    </tr>
    <tr>
      <td><strong>Opportunistic</strong></td>
      <td>20-35</td>
      <td>PickupItem, ThrowGrenade, Taunt</td>
    </tr>
    <tr>
      <td><strong>Fallback/Idle</strong></td>
      <td>5-20</td>
      <td>Patrol, Wander, Idle</td>
    </tr>
  </tbody>
</table>

<h3>Score Distribution Testing</h3>

<p><strong>Use Gameplay Debugger to sample scores over time:</strong></p>

<pre><code>// Ideal distribution (combat scenario)
Attack:     ████████████████░░░░ 40-80 (varies with situation)
TakeCover:  ████████░░░░░░░░░░░░ 20-60 (spikes when threatened)
Reload:     ██████████░░░░░░░░░░ 10-70 (spikes when low ammo)
Retreat:    ██░░░░░░░░░░░░░░░░░░ 5-40  (rarely high)
Patrol:     █░░░░░░░░░░░░░░░░░░░ 5-15  (fallback only)

Good: Clear winner in most frames, variety based on context
Bad: All actions 45-55 (too close, causes thrashing)</code></pre>

<h2>Consideration Tuning</h2>

<h3>Curve Shape Guidelines</h3>

<p><strong>1. Binary (On/Off)</strong></p>
<pre><code>Use: Mandatory prerequisites
Curve: 0→0, 1→100
Example: HasTarget, HasAmmo, CanSeeEnemy

Tuning: If action never fires, soften curve:
  Before: 0→0, 1→100 (strict)
  After:  0→20, 1→100 (allows low-score fallthrough)</code></pre>

<p><strong>2. Linear Scaling</strong></p>
<pre><code>Use: Direct relationships
Curve: 0→0, 0.5→50, 1→100
Example: Health, Ammo, Distance

Tuning: Adjust slope for sensitivity:
  Steep: 0→0, 0.3→100 (high at low values)
  Gentle: 0→0, 0.7→100 (requires high values)</code></pre>

<p><strong>3. Threshold/Step</strong></p>
<pre><code>Use: Emergency responses
Curve: 0→100, 0.3→100, 0.3→0, 1→0
Example: Retreat when health < 30%

Tuning: Adjust threshold position:
  Early: 0.5 threshold (retreat sooner)
  Late: 0.2 threshold (retreat only when critical)</code></pre>

<h3>Multi-Consideration Balance</h3>

<pre><code>Action with 3 considerations:

Scenario 1: All high → High score
  Base: 60 × Consider1: 1.0 × Consider2: 0.9 × Consider3: 0.8 = 43.2

Scenario 2: One zero → Zero score
  Base: 60 × Consider1: 1.0 × Consider2: 0.0 × Consider3: 0.8 = 0.0

Scenario 3: All medium → Medium score
  Base: 60 × Consider1: 0.6 × Consider2: 0.5 × Consider3: 0.7 = 12.6

If action needs to fire in Scenario 3:
  Option A: Increase base score (60 → 80) = 16.8
  Option B: Soften curves (add floor values)</code></pre>

<h2>Difficulty Tuning</h2>

<h3>Easy AI</h3>

<pre><code>Characteristics:
  - Slow reactions (increase service MinInterval)
  - Poor decision-making (add randomness to scores)
  - Predictable patterns (high momentum values)
  - Less aggressive (lower Attack base score)

Implementation:
  PerceptionMonitor: MinInterval = 0.5s (vs 0.2s normal)
  Attack: Base = 50 (vs 60 normal)
  TakeCover: Momentum = 5.0 (vs 3.0 normal)
  Retreat: Threshold = 0.4 health (vs 0.3 normal)</code></pre>

<h3>Normal AI</h3>

<pre><code>Characteristics:
  - Balanced decision-making
  - Reasonable reaction times
  - Mix of aggression and caution
  - Believable errors

Implementation:
  Standard configurations from examples
  Moderate momentum/resistance
  Balanced score distributions</code></pre>

<h3>Hard AI</h3>

<pre><code>Characteristics:
  - Fast reactions (low MinInterval)
  - Optimal decision-making (clean scores)
  - Unpredictable (low momentum)
  - Aggressive (high attack priority)

Implementation:
  PerceptionMonitor: MinInterval = 0.1s
  Attack: Base = 70
  Attack: Low momentum (1.0)
  TakeCover: Threshold = 0.2 health (stays in fight longer)
  Flank: Higher score (more tactical)</code></pre>

<h3>Runtime Difficulty Adjustment</h3>

<pre><code>// Blueprint: Adjust AI difficulty
Event: Set Difficulty (Easy/Normal/Hard)
  Get All Utility AI Pawns
  For Each:
    Get Utility Brain Component
    
    If Difficulty == Easy:
      Boost Action: "TakeCover" (1.3x)
      Nerf Action: "Attack" (0.7x)
      Set Named Input: "ReactionTime" = 0.3 (slower)
    
    Else If Difficulty == Hard:
      Boost Action: "Attack" (1.3x)
      Nerf Action: "Retreat" (0.7x)
      Set Named Input: "ReactionTime" = 1.0 (faster)

// C++ Example
void AGameMode::SetAIDifficulty(EAIDifficulty NewDifficulty)
{
    TArray<APawn*> AIPawns;
    UCIN_UtilityAILibrary::GetAllUtilityAIPawns(this, AIPawns);
    
    float AttackModifier = 1.0f;
    float DefenseModifier = 1.0f;
    
    switch (NewDifficulty)
    {
        case EAIDifficulty::Easy:
            AttackModifier = 0.7f;
            DefenseModifier = 1.3f;
            break;
        case EAIDifficulty::Hard:
            AttackModifier = 1.3f;
            DefenseModifier = 0.7f;
            break;
    }
    
    for (APawn* Pawn : AIPawns)
    {
        UUtilityBrainComponent* Brain = Pawn->FindComponentByClass<UUtilityBrainComponent>();
        if (Brain)
        {
            Brain->SetActionScoreModifier(TEXT("Attack"), AttackModifier);
            Brain->SetActionScoreModifier(TEXT("TakeCover"), DefenseModifier);
        }
    }
}</code></pre>

<h2>A/B Testing</h2>

<h3>Setting Up Variants</h3>

<pre><code>Create preset variants:
  DA_Soldier_Balanced (baseline)
  DA_Soldier_Aggressive (test A)
  DA_Soldier_Defensive (test B)

Spawn equal numbers of each:
  10 Balanced, 10 Aggressive, 10 Defensive

Play test and measure:
  - Time to kill player
  - Survival time
  - Player enjoyment (subjective)
  - Damage dealt vs taken

Choose winner, iterate</code></pre>

<h3>Metrics to Track</h3>

<table>
  <thead>
    <tr>
      <th>Metric</th>
      <th>Good Range</th>
      <th>Action</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>Action switches per minute</td>
      <td>10-30</td>
      <td>Too high → Add resistance, Too low → Reduce momentum</td>
    </tr>
    <tr>
      <td>% time in primary action</td>
      <td>40-60%</td>
      <td>Too high → Nerf action, Too low → Buff action</td>
    </tr>
    <tr>
      <td>Action never used</td>
      <td>0</td>
      <td>Investigate why, fix or remove</td>
    </tr>
    <tr>
      <td>Time to engage player</td>
      <td>2-5s</td>
      <td>Too fast → Easy, Too slow → Hard</td>
    </tr>
  </tbody>
</table>

<h2>Tuning Checklist</h2>

<div class="callout tip">
  <span class="icon"><i data-lucide="check-square"></i></span>
  <div>
    <strong>Before Releasing AI:</strong>
    <ul class="compact">
      <li>✓ All actions execute at least once in 5-minute playtest</li>
      <li>✓ No action dominates more than 70% of time</li>
      <li>✓ No thrashing (switches more than 40x/min)</li>
      <li>✓ Critical actions (reload, heal) complete consistently</li>
      <li>✓ Difficulty variants feel meaningfully different</li>
      <li>✓ AI behavior consistent across multiple playtests</li>
      <li>✓ No "stuck" behaviors (looping, frozen)</li>
      <li>✓ Player can predict AI behavior (not random)</li>
    </ul>
  </div>
</div>

<h2>Next Steps</h2>

<div class="next-steps">
  <a class="button primary" href="#/docs/optimization">
    <i data-lucide="activity"></i>
    Performance Optimization
  </a>
  <a class="button" href="#/docs/momentum">
    <i data-lucide="trending-up"></i>
    Task Momentum Deep Dive
  </a>
</div>

<h3>Related Topics</h3>
<ul>
  <li><a href="#/docs/action-patterns"><i data-lucide="target"></i> Action Design Patterns</a> - Design for tunability</li>
  <li><a href="#/docs/resistance"><i data-lucide="shield"></i> Replace Resistance</a> - Prevent thrashing</li>
  <li><a href="#/docs/debug-basics"><i data-lucide="search"></i> Debug Tools</a> - Observe AI behavior</li>
  <li><a href="#/docs/bp-utility-library"><i data-lucide="code"></i> Blueprint API</a> - Runtime tuning functions</li>
</ul>

<script>lucide.createIcons();</script>
